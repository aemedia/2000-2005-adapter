
= Arel Testing Setup

You should have both rails and the adapter cloned to your typical repo folder. Let's say this 
would be ~/repos referred to as REPOS. As of current make sure your rails checkout is at master
and the sqlserver adapter on the "3.0.0.beta1" topic branch. Make sure to remote track that 
origin topic branch. It's typically good practice to do your work on a local branch of that 
remote tracking branch.

In your environment set RAILS_SOURCE & ARSQLSERVER_SOURCE to the full path of your local repos
for each of rails and the adapter above. You should now be able to run "bundle install" from 
this project root. From here you can start testing, but it is best practice to use the 
"bundle exec ..." commands. For instance:

  $ bundle exec rake spec:sqlserver


= Arel Todo

  338 examples, 64 failures, 3 pending

  * Review/remove our long winded add_limit_offset!
    Supporting:
      - add_lock!
      - add_limit_offset_for_association_limiting!
      - sql_for_association_limiting?
      - change_order_direction
  
  * Find out if this is needed anywhere.
    
    def add_order_by_for_association_limiting!(sql, options)
      # Disertation http://gist.github.com/24073
      # Information http://weblogs.sqlteam.com/jeffs/archive/2007/12/13/select-distinct-order-by-error.aspx
      return sql if options[:order].blank?
      columns = sql.match(/SELECT\s+DISTINCT(.*?)FROM/)[1].strip
      sql.sub!(/SELECT\s+DISTINCT/,'SELECT')
      sql << "GROUP BY #{columns} ORDER BY #{order_to_min_set(options[:order])}"
    end
    
    def orders_and_dirs_set(order)
      orders = order.sub('ORDER BY','').split(',').map(&:strip).reject(&:blank?)
      orders_dirs = orders.map do |ord|
        dir = nil
        ord.sub!(/\b(asc|desc)$/i) do |match|
          if match
            dir = match.upcase.strip
            ''
          end
        end
        [ord.strip, dir]
      end
    end
    
    def order_to_min_set(order)
      orders_dirs = orders_and_dirs_set(order)
      orders_dirs.map do |o,d|
        "MIN(#{o}) #{d}".strip
      end.join(', ')
    end


= Adapter Todo
    
  * Move all sqlserver_adapter/core_ext files to sqlserver/core_ext.
  * Make sure the repair special columns was good to go.
  * Possibly remove 2000 support and query methods.





